image: registry.gitlab.com/showcheap/android-ci:master


before_script:
    - export GRADLE_USER_HOME=`pwd`/.gradle
    - chmod +x ./gradlew
    - sdkmanager "platforms;android-30" > ./log_android        # Specify compileSdkVersion Depends on your android project
    - sdkmanager "build-tools;30.0.0" > ./log_build_tools         # Specify build tool to install, depends on your android project
    - sdkmanager "extras;android;m2repository" > ./log_extras_repository  # You can add sdkmanager command to install another package here
    - sdkmanager "extras;m2repository;com;android;support;constraint;constraint-layout;1.0.2" > ./log_extras_constraint # If you need constraint-layout support




stages:
  - test
  - build
  - deploy


unitTest:
  stage: test
  only:
     - master@karimkod/gitlabcisample
  script:
     - ./gradlew check
     
codeanalysis:
  stage: test
  only:
     - master@karimkod/gitlabcisample
  script: 
     - ./gradlew detektCheck




build:
  stage: build
  only:
    - master@karimkod/gitlabcisample
  script:
     - ./gradlew assemble


deploy: 
  stage: deploy
  only:
    - master@karimkod/gitlabcisample
  script:
     - ./gradlew assembleRelease crashlyticsUploadDistributionRelease
